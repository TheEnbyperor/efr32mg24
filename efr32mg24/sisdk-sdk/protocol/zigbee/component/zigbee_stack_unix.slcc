id: zigbee_stack_unix
label: Zigbee Stack Unix
package: Zigbee
category: Zigbee
quality: production
description: This plugin contains defines, source files, and include paths to build Zigbee apps against Linux.

provides:
  - name: zigbee_stack_unix
  - name: zigbee_simulation_or_zigbee_stack_unix
  - name: emlib_system
    condition:
      - zigbee_stack_unix
  - name: emlib_gpio
    condition:
      - zigbee_stack_unix
  - name: hal_generic_gpio
    condition:
      - zigbee_stack_unix
  - name: emlib_common
    condition:
      - zigbee_stack_unix
  - name: emlib_core
    condition:
      - zigbee_stack_unix
  - name: emlib_emu
    condition:
      - zigbee_stack_unix
  - name: clock_manager_runtime
    condition:
      - zigbee_stack_unix
  - name: legacy_hal
    condition:
      - zigbee_stack_unix
  - name: token_manager
    condition:
      - zigbee_stack_unix
  - name: rail_util_ant_div
    condition:
      - zigbee_stack_unix
  - name: rail_util_coex
    condition:
      - zigbee_stack_unix
  - name: rail_util_pti
    condition:
      - zigbee_stack_unix
  - name: device_init_core
    condition:
      - zigbee_stack_unix
  - name: sleeptimer
    condition:
      - zigbee_stack_unix
  - name: device_host
    condition:
      - zigbee_stack_unix
  - name: device
    condition:
      - zigbee_stack_unix
  - name: device_restricted
    condition:
      - zigbee_stack_unix
  - name: mbedtls_entropy_source
    condition:
      - zigbee_stack_unix
  - name: zigbee_debug_basic
    condition:
      - zigbee_stack_unix
  - name: legacy_printf
    condition:
      - zigbee_stack_unix

requires:
  - name: sl_system_init
  - name: sl_system_process_action
  - name: sl_common
  - name: sl_core
  - name: operating_system
  - name: zigbee_stack_unix_library
    condition:
      - zigbee_use_release_libraries
  - name: zigbee_stack_unix_implementation
  - name: zigbee_third_party_openthread

recommends:
  - id: linux
  - id: zigbee_stack_unix_source

library:
  - system: util
  - system: stdc++

include:
  - path: ./
    file_list:
      - path: platform/common/inc/sl_enum.h
      - path: platform/radio/rail_lib/plugin/coexistence/protocol/ieee802154_uc/coexistence-802154.h
      - path: platform/radio/rail_lib/plugin/coexistence/protocol/ieee802154_uc/coexistence-common-802154.h
      - path: platform/service/iostream/inc/sl_iostream_swo_itm_8.h
      - path: platform/service/iostream/inc/sl_iostream.h
      - path: platform/service/legacy_hal/inc/button.h
      - path: platform/service/legacy_hal/inc/crc.h
      - path: platform/service/legacy_hal/inc/em2xx-reset-defs.h
      - path: platform/service/legacy_hal/inc/hal.h
      - path: platform/service/legacy_hal/inc/hal/hal.h
      - path: platform/service/legacy_hal/inc/led.h
      - path: platform/service/legacy_hal/inc/micro-common.h
      - path: platform/service/legacy_hal/inc/micro-types.h
      - path: platform/service/legacy_hal/inc/micro.h
      - path: platform/service/legacy_hal/inc/platform-header.h
      - path: platform/service/legacy_hal/inc/random.h
      - path: platform/service/legacy_hal/inc/serial.h
      - path: platform/service/legacy_hal/inc/serial.h
      - path: platform/service/legacy_hal/inc/serial/serial.h
      - path: platform/service/legacy_host/inc/token.h
      - path: protocol/zigbee/app/zigbeed/zigbeed_configuration.h
      - path: protocol/zigbee/app/zigbeed/serial_adapter.h
      - path: protocol/zigbee/stack/framework/zigbee_debug_channel.h
  - file_list:
      - path: em_device.h
      - path: simulation_event_sc12.h
      - path: simulation_gpio_p.h
      - path: simulation_gpio.h
      - path: simulation_sc.h
    path: platform/Device/SiliconLabs/simulation/Include/
  - path: ./
  - path: protocol/zigbee/stack
  - path: protocol/zigbee/stack/framework
  - path: platform/service/legacy_host/inc
  - path: platform/service/legacy_common_ash/inc
  - path: platform/service/legacy_ncp_ash/inc
  - path: platform/service/token_manager/inc
    file_list:
      - path: sl_token_manufacturing_unix.h
  - path: platform/emlib/host/inc
    file_list:
      - path: em_core.h
      - path: em_core_generic.h
  - path: platform/service/legacy_hal/inc
    file_list:
      - path: rijndael-alg-fst.h
      - path: rijndael-api-fst.h
      - path: security_unix.h
      - path: platform-header.h
      - path: random.h

# used by zigbeed/simulator_stubs.c
  - path: platform/radio/rail_lib/plugin/coexistence/protocol/ieee802154_uc

  - path: platform/common/inc

# used by iostream_printf?
  - path: platform/service/iostream/inc

# for openthread-config-generic.h
# this is a platform-specific file generated by the OT build system,
# and I just copied it over as a temporary workaround.  We should
# move it in with lower-mac-spinel at the minimum.
  - path: protocol/zigbee/app/zigbeed

source:

# Posix Stubs
  - path: protocol/zigbee/app/zigbeed/simulator_stubs.c
  - path: protocol/zigbee/app/zigbeed/micro-stubs.c
# implements sl_zigbee_serial* functions for a posix target, opening a tty
# possibly move file to something like:
# platform/service/legacy_serial/ember-serial-posix.c
  - path: platform/service/token_manager/src/sl_token_def.c
  - path: protocol/zigbee/app/zigbeed/serial_adapter.c
  - path: platform/service/legacy_host/src/token.c
  - path: platform/service/legacy_hal/src/rijndael-alg-fst.c
  - path: platform/service/legacy_hal/src/rijndael-api-fst.c
  - path: platform/service/legacy_hal/src/random.c
  - path: platform/service/legacy_hal/src/system-timer.c
  - path: platform/service/legacy_hal/src/crc.c
  # not brought in by default, since this component provides zigbee_debug_basic
  - path: protocol/zigbee/stack/framework/debug-stub.c

define:
  - name: UNIX_HOST
  - name: ZIGBEE_STACK_ON_HOST
  - name: ZIGBEE_PRO_COMPLIANCE_ON_HOST
    condition:
      - zigbee_pro_compliance

# used in lots of places. in most places UNIX_HOST would be a better name,
# but it would be a lot of work to refactor    
  - name: SL_ZIGBEE_TEST
    condition:
      - zigbee_pro_compliance
# only used in platform/radio/mac/upper-mac.h and lower-mac.h to include phy.h
  - name: UNIX

# only used in micro-types.h
  - name: PHY_SIMULATION

# only used in app/framework/security/af-trust-center in reverse()
  - name: BOARD_SIMULATION

# only used in app-main.c to call sli_legacy_serial_init()
  - name: APP_SERIAL
    value: 1
  - name: APP_BAUD_RATE
    value: BAUD_115200

  - name: PLATFORM_HEADER
    value: "\"platform-header.h\""
  - name: __INLINE
    value: inline
  - name: STACK_TYPES_HEADER
    value: "\"stack/include/sl_zigbee_types.h\""
  - name: STACK_HEADER
    value: "\"stack/include/sl_zigbee.h\""
  - name: STACK_CORE_HEADER
    value: "\"stack/core/sl_zigbee_stack.h\""

# used in util/silicon_labs/silabs_core/event_control/event-control and 
# util/silicon_labs/silabs_core/event_control/event
  - name: EMBER_NO_IDLE_SUPPORT
    value: 1

# running on the host so no bootloader
  - name: EZSP_NO_BOOTLOADER
    value: 1

# mbedtls_config_autogen.h
  - name: TEST_SUITE_MEMORY_BUFFER_ALLOC

  - name: CONFIGURATION_HEADER
    value: "\"../../../zigbeed/zigbeed_configuration.h\""
    unless:
      - zigbee_pro_compliance

# TODO: Need to turn off optimizations to make it work on Linux
toolchain_settings:
  - option: optimize
    value: none
  - option: gcc_compiler_option
    value: -Wno-unused-parameter
  - option: gcc_compiler_option
    value: -Wno-missing-field-initializers
  - option: gcc_compiler_option
    value: -Wno-missing-braces
  - option: gcc_compiler_option
    value: -Werror
  # On Mac, clang 12 forces 64 bit compilation to error on violations of
  # implicit-function-declaration. We are not there yet in fixing all violations
  # (there is a PIT effort to catalog warnings and fix them), so for now, we
  # turn it off. This has not been an issue until now because 32 bit compilation
  # does not turn error on implicit references
  - option: gcc_compiler_option
    value: -Wno-error=implicit-function-declaration
  - option: gcc_linker_option
    value: -Wl,--start-group -Wl,--end-group

template_contribution:
  - name: component_catalog
    value: zigbee_stack_unix

documentation:
  docset: zigbee
  document: zigbee-af-api/linux
metadata:
  sbom:
    license: MSLA AND Zlib
